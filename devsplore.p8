pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
--devsplore
--par nas

function _init()
create_player()
score=20
state=0 --etat avant le game over
enemies={} --tableau des ennemis
gain=0--arrete le spawn des badges
badges={}--tableau des badges
coupes={}--tableau de la coupe
final=0--arrete le spawn des des coupes
end

function _update()
--lancement du jeu state=0
if (state==0) update_game()
if (state==1) update_gameover()
end

function _draw()
if (state==0) draw_game()
if (state==1) draw_gameover()
end


-->8
--map

function draw_map()
	map(0,0,0,0,128,64)
end

function check_flag(flag,x,y)
	local sprite=mget(x,y)
	return fget(sprite,flag)
end

function update_camera()
local camx=flr(p.x/16)*16
local camy=flr(p.y/16)*16
camera(camx*8,camy*8)
end
-->8
--personnage principal

function create_player()
p={
	x=3,
	y=15,
	sprite=1,
}
end

function draw_player()
	spr(p.sprite,p.x*8,p.y*8)
end

function player_movement()
	newx=p.x
	newy=p.y

	if(btnp(➡️)) newx+=1
	if(btnp(⬅️)) newx-=1
	if(btnp(⬇️)) newy+=1
	if(btnp(⬆️)) newy-=1

	if not check_flag(0,newx,newy) then
		p.x=newx
		p.y=newy
	end
end
-->8
--score

function update_game()
	player_movement()
	enemy_movement()
	if #enemies==0 then
		spawn_enemies(2)
	end
	collision()
	if gain==0 then
	spawn_badges()
	end
	interact()
	update_camera()
	if score<=0 then 
		state=1
		sfx(5)
	end
	if final==0 then
	spawn_coupe()
	end
	win()
end

function update_gameover()
	if (btn(❎)) _init()
end

--affichage jeu
function draw_game()
cls(3)
draw_map()
draw_player()
draw_enemy()
draw_badges()
--score view=confiance
rectfill(57,8,2,1,7)
print("confiance: ",5,2,1)
print(score,45,2,1)
draw_coupe()
draw_win()
end


function draw_gameover()
--afficher le menu gameover
	cls(14)
	rectfill(31,53,105,87,0)
	rectfill(29,50,102,82,1)
	print("score:"..score,38,56,7)
	print("presse ❎ pour\nreessayer",36,66,10)
end

function draw_win()
	if p.x>=16 and p.y>=2 then
	rectfill(159,53,233,87,0)
	rectfill(157,50,230,82,10)
	print("bravo,\nbeau parcours !\ncontinue comme ca!",160,56,1)
	end
end


-->8
--ememies

function draw_enemy()
	for e in all(enemies) do
	spr(e.sprite,e.x*8,e.y*8)
	end
end

function spawn_enemies(amount)
gap=(25-8*amount)/(amount+1)
	for i=1,amount do
		new_enemy = {
 		x = gap*i+8*(i-1),
  	y = rnd(16),
  	sprite=11,
  	speed=1/30,
	}
		new_enemy2 = {
 		x = gap*i+8*(i-1),
  	y = rnd(16),
  	sprite=23,
  	speed=1/30,
	}
	add(enemies, new_enemy)
	add(enemies, new_enemy2)
	end
end

--collision
function collision()
	for e in all(enemies) do
		if p.x<=flr(e.x)+1 and
					p.x>=flr(e.x)-1 and
					p.y<=flr(e.y)+1 and
					p.y>=flr(e.y)-1 then
 		score-=10
 		del(enemies,e)
 		sfx(2)
 	end
	end
end

--mouvements aleatoires
function enemy_movement()
	for i in pairs(enemies) do 
		local	anewy=enemies[i].y+(flr(rnd(3)-1))
		local	anewx=enemies[i].x+(flr(rnd(3)-1))
		 --blocage par le decor
			if not check_flag(0,anewx,anewy)
			then
				enemies[i].x=anewx
				enemies[i].y=anewy
			end
			--cadrage
			if (enemies[i].x<0) enemies[i].x=0
			if (enemies[i].x>15) enemies[i].x=15 
			if (enemies[i].y<0) enemies[i].y=0
			if (enemies[i].y>15) enemies[i].y=15
			end
end

-->8
-- badges

function spawn_badges()
	new_badge = {
 		x = 4,
  	y = 8,
  	sprite=51,
	}
	
	new_badge2 = {
			x=12,
			y=5,
			sprite=52,
	}
	
	new_badge3 = {
		x=2,
		y=13,
		sprite=52
	}
	add(badges, new_badge)
	add(badges, new_badge2)
	add(badges, new_badge3)
	gain=1 
end

function draw_badges()
	for b in all(badges) do
	spr(b.sprite,b.x*8,b.y*8)
	end
end

function interact()
for b in all(badges) do
		if p.x<=flr(b.x)+1 and
					p.x>=flr(b.x)-1 and
					p.y<=flr(b.y)+1 and
					p.y>=flr(b.y)-1 then
 		score+=20
 		del(badges,b)
 		sfx(3)
 	end
	end
end
-->8
--coupe

function spawn_coupe()
	new_coupe = {
 		x =18,
  	y = 2,
  	sprite=53,
	}
		add(coupes, new_coupe)
		final=1
end

function draw_coupe()
	for c in all(coupes) do
	spr(c.sprite,c.x*8,c.y*8)
	end
end

function win()
for c in all(coupes) do
		if p.x<=flr(c.x)+1 and
					p.x>=flr(c.x)-1 and
					p.y<=flr(c.y)+1 and
					p.y>=flr(c.y)-1 then
 		del(coupes,c)
 		sfx(4)
 	end
	end
end
__gfx__
00000000005cc90060606060444444444444eeee444444440000004460eeeeee00000000000000000bb6b6b0000550003333333336666666eeeeeeee65eeeeee
0000000005c5cc9000000000444444444444eeee444444440000004406eeeeee0000000000000006b9bb9bbb055555506666666636666666eeeeeeee56eeeeee
007007000cf1f1c000000000000000004444eeee444444440000004460eeeeee0000000000000000669bb9b6505555056666666636666666eeeeeeee65eeeeee
0007700000cfff0000000000000000004444eeee444444440000004406eeeeee0000000000000006b64baabb5055550566666666366666664444444456444444
000770000022f80000000000000000004444eeee444444440000004460eeeeee00000000000000000b696b6b055555506666666636666666eeeeeeee65eeeeee
00700700f222288f00000000000000004444eeee444444440000004406eeeeee000000000000000600b6b6b0509559056666666636666666eeeeeeee56eeeeee
000000000025580000000000000000004444eeee444444440000004460eeeeee000000000000000000044000505005056666666636666666eeeeeeee65eeeeee
0000000000555d0000000000000000004444eeee444444440000004406eeeeee606060600000000600054000000000006666666636666666eeeeeeee56eeeeee
000000003333333300000000008000000000900088888888eeeeeeee05bb5500666666633666666336666666333333333333333366666666eeeeeddeeeeeeeee
00000000666666660900009008a8b0000009890088888888eeeeeeee55b5b500666666633666666336666666366666666666666366666666eeeeeddeeeeeeeee
000000006666666649444494bb80b00b0900900088888888eeeeeeee5bbbb505666666633666666336666666366666666666666366666666eeeeedde44444444
0000000066666666494994940bbbb8bb9890009088888888eeeeeeee585b5559666666633666666336666666366666666666666366666666eeeeee4e44444444
0000000066666666494994940bbb8a800900098988888888eeeeeeee855b5540666666633666666336666666366666666666666366666666eecccc4ee44ee44e
000000006666666649444494beebb8bb0009009088888888eeeeeeee059b5bb9666666633666666336666666366666666666666366666666ee44444ee44ee44e
000000006666666609000090bbbeeeb00098900088888888eeeeeeee059bbb45666666633666666336666666366666666666666366666666ee4eee4ee44ee44e
000000003333333300000000bbbbbbb00009000088888888eeeeeeee05594955333333333666666333333333366666666666666366666666ee4eee4eeeeeeeee
00000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000004444440000000000aea0a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000004d4dd400000000000a0aea0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000009d99d900000000000000a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000099999900000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000d00d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000004004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000eddeeeeeeeeeee5e000cc00000088000090009a000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000eddeeeeeeeeee55e00c11c00008ee800090009a000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000eddeeeeeeeeee55e0c6666c008666680099099a000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000e4eeeeeeeeeee55ec6ddd66c866dd6680a999aa000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000e4cccceeeeeee55ec6d6dd6c86d6dd680aaaaaa000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000e44444eeeeeee55e0c6666c00866668000aaaa0000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000e4eee4eeeeeee55e00c66c0000866800000aa00000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000e4eee4eeeeeeee5e000cc00000088000000aa00000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000010101010101010101010000010100000101010000010000000000000101000100010000000000000000000000000001010303000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0a0a0a220a0a0a0a0a0a0a0a0a0a0a0505050505050505050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a0a000a00000a0a00140a0a0a14210416161515161616160500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
22000012230a1223121b11111111111d1d151615073131160524242424242424242424240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a0a131b111111111118130a0a13131d1d161515073131320524242424242424242424240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2200131914130a13130a24242414240416161616073131160524242424242424242424240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a00131a11111111111c142424142404161616160f0e0e0e0524241d1d1d1d1d242424240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a0a00121323120a0a0d1111241424041616161507311f1e0524241d14141414242424240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a22142424240a000a1913140a2424071616151507161616050a0a1d14141414242424240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a000a2324241313131a111111111c0416151615071616161d1d1d1d14141414242424240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a00240a14110c11232324241313190416161515161616161d1d1d1d14141414242424240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a0a2424221419132424240a1b1118041616161616311f1e050a0a1d14141414242424240000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a0013232323190a0a13241419231307161616160f0e0e0e0524241d14141414000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a0a1b11111118242413240a1a0c130416161515071616160524241d1d1d1d1d000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a0a1914141414242414240a0a19130416151615071616160524242424242424000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
220a192114141412131313121219130716161515161616160524242424242424000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0a0a1a11111111111111111111180a0505050505050505050524242424242424000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0022231423140a0a0a220a121212242424242424242424242424242424242424000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000024242424240a24240a242424242424242424242424242424242424242424000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000024242424240a24240a242424242424242424242424242424242424242424000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000024242424240a0a0a0a242424242424242424242424242424242424242424000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
000f000025650286502b650000001c000200002300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
012e0000094500e4500a4500e45021000174001b400164001b400301003410030100301003010030100301002e1002a1002410023100221002410028100311000000000000000000000000000000000000000000
001200001805018050140501205000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
001000001f05027050330502000035050310002c00031000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0010000000000221202313024100281502b1002c150001003015037150341503715039100381003a1001a00000000286002760026600256002460024600246002560025600000000000000000000000000000000
00150000255501d5501855014550115500e5500b55008550075500755006550045500455004550045500455002550025500255002550005500055000000000000000000000000000000000000000000000000000
